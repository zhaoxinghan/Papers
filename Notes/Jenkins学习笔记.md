# Jenkins学习笔记（一）

《Jenkins2 权威指南》学习笔记

## 基础

### 语法

#### 脚本式流水线和声明式流水线

1. 脚本式流水线：在流水线中定义逻辑和程序流程，更依赖于Groovy语言和结构
2. 声明式流水线：代码被编排在段落中，这些流水线的主要区域声明了我们所期望的流水线的状态和输出。

#### 系统：主节点、节点、代理节点、执行器


- 主节点（master）：是一个实例（instance）的主要控制系统，能够访问所有配置选项和任务。如果没有指定其他系统，也是默认的任务执行节点。**不要在主节点安排高负载任务**
- 节点（node）：代表了任何可以执行jenkins任务的系统，包含主节点和代理节点，也可以是一个容器Docker。
- 代理节点（agent）：早期版本被称为从节点（slave），代表了非主节点的系统。由主节点管理，按需分配执行执行特定的任务。例如可以分配不同的代理节点针对不同的操作系统执行构建任务，或者并发的运行测试任务。代理节点在节点上运行。在脚本式流水线中，节点特指开一个运行代理节点的系统，而在声明式流水线中，其指代一个特定的代理节点来分配节点。

> note和agent除了语法之外，区别并不是很明显，只要知道note用于脚本式流水线，而agent用于声明式流水线。

- 执行器（execute）：执行器是节点\代理节点执行任务的一个插槽。一个节点可以由任意多的执行器，其数量定义了节点并发任务的数量。当主节点分配任务时，该节点必须有空余的执行器插槽来执行该任务，否则就会被挂起。

#### DSL和Groovy

Jenkins的流水线DSL基于Groovy语言实现。

声明式流水线禁止使用定义结构之外的几乎所有的Groovy代码。

#### 节点（node）

节点在```管理jenkins -> 管理节点```中定义。node的参数为节点的**标签**，后边的代码为该标签的节点下运行的任务。如果忽略名称，则在第一个有效的执行器下运行。
节点的标签可以使用逻辑运算符来定义多个属性，例如
```groovy
node("linux && east")
```
#### 阶段（stage）

只是用于描述，本质上并没有做什么事情。

#### 步骤（step）

实际的DSL命令，是最基本的功能。它不是groovy命令，但是可以和它搭配使用。

*如果命令的参数只有一个，则可以省略参数名称* 

> 总结： 一个节点包含若干阶段，一个阶段包含若干步骤






